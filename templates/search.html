<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Rosario:400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <link href="//cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />
    <title>{{.Title}}</title>
    {{if not .IsSealed}}
        <script type="text/javascript" src="../js/autocomplete.js"></script>
        <script type="text/javascript" src="../js/fetchnames.js"></script>
    {{end}}
    {{if not (eq .ChartID "")}}
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>
        <script type="text/javascript" src="../js/chartopts.js"></script>
    {{end}}
</head>

<body class="light-theme">
<script type="text/javascript" src="../js/themechecker.js"></script>
<nav>
    <ul>
        <li><a href="https://www.patreon.com/ban_community"><img src="img/misc/patreon.png" width=48></a></li>
        <li><a href="/discord"><img src="img/misc/discord.png" width=48></a></li>
        {{range .Nav}}
            <li>
                <a {{if .Active}}class="{{.Class}}"{{end}} href="{{.Link}}">
                    <span>{{.Short}} {{.Name}}</span>
                </a>
            </li>
        {{end}}
        <li>
            <label class="switch">
                <div>
                    <input type="checkbox"/>
                    <span class="slider"></span>
                </div>
                <script type="text/javascript" src="../js/nightmode.js"></script>
            </label>
        </li>
    </ul>
</nav>

<div class="mainbody">
    {{if ne .ErrorMessage ""}}
        <h1>{{.ErrorMessage}}</h1>
        {{if .ShowPromo}}
            <img class="center" src="img/promo/search.jpg">
        {{end}}
    {{else if eq .Title "Options"}}
        <script type="text/javascript" src="../js/cookies.js"></script>
        <br>

        <script type="text/javascript">
            window.onload = function(e) {
                loadForm("SearchSellersList", "sellers");
                loadForm("SearchVendorsList", "vendors");
                loadForm("SearchMiscOpts", "miscOpts");
                loadRadio("SearchDefaultSort", "defaultSort");
                loadRadio("SearchListingPriority", "listingPriority");
            }
        </script>

        <div class="indent">
            <h2>Stores</h2>
            Select which sellers or vendors you <b>don't</b> want to display in your searches.
            <br>

            <a class="btn warning" onclick="javascript:clearForm('sellers'); clearForm('vendors');"><b>CLEAR</b></a>
            <a class="btn success" onclick="javascript:selectAll('sellers');"><b>Select ALL Sellers</b></a>
            <a class="btn success" onclick="javascript:selectAll('vendors');"><b>Select ALL Vendors</b></a>
            <a class="btn success" onclick="javascript:saveForm('SearchSellersList', 'sellers'); saveForm('SearchVendorsList', 'vendors'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="sellers">
                {{range $i, $key := .SellerKeys}}
                    <input type="checkbox" id="s{{$key}}" name="{{$key}}">
                    <label for="s{{$key}}">
                        {{scraper_name $key}}
                    </label>
                    <br>
                {{end}}
            </div>
            <div class="column" id="vendors">
                {{range $i, $key := .VendorKeys}}
                    <input type="checkbox" id="v{{$key}}" name="{{$key}}">
                    <label for="v{{$key}}">
                        {{scraper_name $key}}
                    </label>
                    <br>
                {{end}}
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Result sorting</h2>
            Select how card results should be sorted by.
            <br>

            <a class="btn success" onclick="javascript:saveRadio('SearchDefaultSort', 'defaultSort'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="defaultSort">
                <input type="radio" id="chrono" name="sort" value="chrono" checked>
                <label for="chrono">By chronological order</label>
                <br>
                <input type="radio" id="alpha" name="sort" value="alpha">
                <label for="alpha">By alphabetical order</label>
                <br>
                <input type="radio" id="retail" name="sort" value="retail">
                <label for="retail">By best retail price (off TCGplayer)</label>
                <br>
                <input type="radio" id="buylist" name="sort" value="buylist">
                <label for="buylist">By best buylist price (off Card Kingdom)</label>
                <br>
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Listing priority</h2>
            Select how price results should be sorted by.
            <br>

            <a class="btn success" onclick="javascript:saveRadio('SearchListingPriority', 'listingPriority'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="listingPriority">
                <input type="radio" id="stores" name="priority" value="stores" checked>
                <label for="stores">Alphabetical, by store name</label>
                <br>
                <input type="radio" id="prices" name="priority" value="prices">
                <label for="prices">Asc for Retail, Desc for Buylist, by prices</label>
                <br>
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Other preferences</h2>
            Miscellaneous life hacks for Search.
            <br>

            <a class="btn warning" onclick="javascript:clearForm('miscOpts');"><b>CLEAR</b></a>
            <a class="btn success" onclick="javascript:saveForm('SearchMiscOpts', 'miscOpts'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="miscOpts">
                <input type="checkbox" id="hidePromos" name="hidePromos">
                <label for="hidePromos">Hide Promotional entries (<i>promopack, prerelease, etc</i>)</label>
                <br>
                <input type="checkbox" id="hideBLconds" name="hideBLconds">
                <label for="hideBLconds">Hide non-NM Buylist entries</label>
                <br>
                <input type="checkbox" id="skipEmpty" name="skipEmpty">
                <label for="skipEmpty">Skip results with no prices</label>
                <br>
                <input type="checkbox" id="noSyp" name="noSyp">
                <label for="noSyp">Don't show the SYP indication (†)</label>
                <br>
            </div>
        </div>

    {{else}}
        <h1>
            Welcome to BAN {{if .IsSealed}}Sealed{{else}}{{if not (eq .ChartID "")}}Chart{{end}} Search{{end}}

            {{if .TotalUnique}}
                -
                <small><small><small>
                    {{.TotalUnique}}
                    {{if .IsSealed}}product{{else}}card{{end}}{{if gt (len .AllKeys) 1}}s{{end}} found
                    {{if gt .TotalUnique (len .AllKeys)}}
                        ({{len .AllKeys}} shown)
                    {{end}}
                </small></small></small>
            {{end}}
        </h1>

        {{if .IsSealed}}
            <img id="hoverImage" src="" style="position:absolute; z-index: 3; max-width: 360px; max-height: 360px;"/>
            <script type="text/javascript" src="../js/followmouse.js"></script>
        {{end}}

        <div class="indent sticky" style="top: 48px; background-color: var(--background); float:left">
            <form class="search autocomplete" action="" autocomplete="off" spellcheck="false" id="searchform">
                <label style="clear: both; float: left; width: 110%" for="searchbox">
                    {{if not .SearchQuery}}
                        Search for a card, or... <a class="btn info" href="/random">surprise me</a>
                    {{else}}
                        Sort by
                        {{if .NoSort}}
                            syntax
                        {{else}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=" title="Sort by chronological order">
                                {{if or (eq .SearchSort "chrono") (not .SearchSort)}}<b>{{end}}chrono{{if or (eq .SearchSort "chrono") (not .SearchSort)}}</b>{{end}}
                            </a>
                            {{if or (eq .SearchSort "chrono") (not .SearchSort)}}
                                <a href="?q={{.SearchQuery}}&sort=&reverse={{not .ReverseMode}}" title="Sort by reverse chronological order">🔄</a>
                            {{end}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=alpha" title="Sort by alphabetical order">
                                {{if eq .SearchSort "alpha"}}<b>{{end}}alpha{{if eq .SearchSort "alpha"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "alpha"}}
                                <a href="?q={{.SearchQuery}}&sort=alpha&reverse={{not .ReverseMode}}" title="Sort by reverse alphabetical order">🔄</a>
                            {{end}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=retail" title="Sort by best retail price (off TCGplayer)">
                                {{if eq .SearchSort "retail"}}<b>{{end}}retail{{if eq .SearchSort "retail"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "retail"}}
                                <a href="?q={{.SearchQuery}}&sort=retail&reverse={{not .ReverseMode}}" title="Sort by lowest retail price (off TCGplayer)">🔄</a>
                            {{end}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=buylist" title="Sort by best buylits price (off Card Kingdom)">
                                {{if eq .SearchSort "buylist"}}<b>{{end}}buylist{{if eq .SearchSort "buylist"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "buylist"}}
                                <a href="?q={{.SearchQuery}}&sort=buylist&reverse={{not .ReverseMode}}" title="Sort by lowest buylits price (off Card Kingdom)">🔄</a>
                            {{end}}
                        {{end}}
                        <span class=emoji>
                            <a class="btn info" title="...more surpises" href="/random">🎰</a>
                        </span>
                    {{end}}
                    <span class=emoji>
                        <a href="?page=options" title="Search settings">⚙️</a>
                    </span>
                </label>
                <input id="searchbox" class="w3-input w3-border w3-round-small search-input" onFocus="this.setSelectionRange(0, this.value.length)" type="text" name="q" placeholder="Enter a card name" value="{{.SearchQuery}}" maxlength="200" autofocus>
            </form>

        {{if not .IsSealed}}
            <script type="text/javascript">
                autocomplete(document.getElementById("searchform"), document.getElementById("searchbox"));
            </script>
        {{end}}
        {{if eq .SearchQuery ""}}
            <div class="indent">
                <h2>Instructions</h2>
                <br>
                <ul class="indent">
                    <li><h4><i>Syntax</i></h4>
                        <ul class="indent">
                            <li>You can search using the Pricefall bot notation: <pre>name[|code[|number]]{&amp;*~}</pre>.</li>
                            <li>If you append a special character to any search, you can filter by finish: <pre>&amp;</pre> for nonfoil-only, <pre>*</pre> for foil-only, or <pre>~</pre> for etched-only results. Note that this syntax is disabled if you used a regular expression option to avoid aliasing.</li>
                            <li>You can filter by <b>edition</b> using the Scryfall notation <pre>s:CODE</pre> and the full edition name (enclosed in quotes) <pre>s:"Aether Revolt"</pre>. Regular expressions are supported with the <pre>se</pre> option.</li>
                            <li>You can filter by <b>collector number</b> using the Scryfall notation <pre>cn:NUMBER</pre>. For simple numbers (without any prefix or suffix) you may also filter with <pre>cn&gt;NUMBER</pre> and <pre>cn&lt;NUMBER</pre>. Regular expressions are also supported if you use <pre>cne:REGEXP</pre>.</li>
                            <li>You can filter by <b>condition</b> with <pre>cond:COND</pre>, accepting <pre>NM</pre>, <pre>SP</pre>, <pre>MP</pre>, <pre>HP</pre>, and <pre>PO</pre>. You can be selective and filter only retail or buylist prices with <pre>condr:COND</pre> and <pre>condb:COND</pre> respectively.</li>
                            <li>You can filter by <b>rarity</b> with <pre>r:RARITY</pre>, accepting <pre>mythic</pre>, <pre>rare</pre>, <pre>uncommon</pre>, <pre>common</pre>, <pre>special</pre>, <pre>token</pre>, and <pre>oversize</pre>. You can also use the first letter of the rarity as shorthand.</li>
                            <li>You can filter by <b>color</b> and <b>color_identity</b >with <pre>c:COLOR</pre> and <pre>ci:COLOR</pre>, using standard WURGB letters, or guilds, shards, college, and quad color names.</li>
                            <li>You can filter by <b>finish</b> with <pre>f:VALUE</pre>, accepting <pre>nonfoil</pre>, <pre>foil</pre>, and <pre>etched</pre>. Short form is available as <pre>nf</pre>, <pre>f</pre>, and <pre>e</pre>.</li>
                            <li>You can filter by <b>card type</b> with <pre>t:VALUE</pre>, accepting any valid supertype, subtype, or type.</li>
                            <li>You can filter by <b>release date</b> of the card or set <pre>date:VALUE</pre>, <pre>date&gt;VALUE</pre>, and <pre>date&lt;VALUE</pre>. The value may be a date in the ISO format (<pre>YYYY-MM-DD</pre>) or a set code.</li>
                            <li>
                                You can filter by card properties using <pre>is:VALUE</pre>, accepting these self describing options:
                                <ul class="indent">
                                    <li>Generic propeties: <i>reserved, token, oversize, funny, wcd promo</i></li>
                                    <li>Frame properties: <i>fullart (fa), extendedart (ea), showcase (sc), reskin, borderless (bd), gold, retro</i></li>
                                    <li>Promo properties: <i>{{range $.PromoTags}}{{.}}, {{end}} promo</i></li>
                                    <li>Language properties: <i>japanese (jp, jpn), phyrexian (ph)</i></li>
                                    <li>Land sets: <i>dual, fastland, fetchland, painland, shockland, checkland</i></li>
                                </ul>
                            </li>
                            <li>There is limited support for human readable tags, for example if <pre>(Extended Art)</pre> is appended to a card name, the search will only show cards that are Extended Art (similar to the <pre>is:extendedart</pre> filter). Note that this syntax will not work with regexp search mode.</li>
                            <li>You can change the <b>search mode</b> with <pre>sm:VALUE</pre>, accepting <pre>exact</pre> (default), <pre>prefix</pre>, <pre>any</pre>, or <pre>regexp</pre>:</li>
                            <ul class="indent">
                                <li>Normally a card is searched with an <b>exact</b> strategy, you will get only cards with exactly the same name as searched.
                                    <br>For example <pre>Vesuva</pre> will return the card named Vesuva and no other Vesuvan counterpart.</li>
                                <li>If you search in <b>prefix</b> mode, you will get all the cards with the name starting with what you searched.
                                    <br>For example <pre>"Dragonlord"</pre> will return all the cards starting with "Dragonlord".</li>
                                <li>If you search in in <b>any</b> mode, you will get all the cards containing any of the text present in card names.
                                    <br>For example <pre>*Draco*</pre> will return the card named Draco and all the cards that have "draco" in their names.</li>
                                <li>If you search in in <b>regexp</b> mode, you will get all the cards names matching the regular expresion.
                                    <br>For example <pre>Cluestone$</pre> will return the card that end with Cluestone in their name. Note this search mode is case sensitive.</li>
                            </ul>
                            <li>You can change the <b>sort mode</b> with <pre>sort:VALUE</pre>, accepting <pre>chrono</pre> (chonologically by print date, default), <pre>alpha</pre> (for alphabetical order), <pre>retail</pre> (for TCG price order), or <pre>buylist</pre> (for CK buylist price order). Note that when this option is set, the sort UI will be disabled.<</li>
                            <li>You can set any option in any order, in any amount. When filtering for a group of values you can use a comma <pre>,</pre> to separate values.</li>
                            <li>You can invert filter results by prepending a <pre>-</pre> to the option name.</li>
                            <li>You can filter by <b>seller/vendor name</b> with <pre>store:shorthand</pre>, or specific types of store with <pre>seller:shorthand</pre> and <pre>vendor:shorthand</pre>.</li>
                            <ul class="indent">
                                <li>For well known store names, you may use the following self-describing tags: <pre>TCG_LOW</pre>, <pre>TCG_MARKET</pre>, <pre>TCG_PLAYER</pre>, <pre>TCG_DIRECT</pre>, <pre>TCG_DIRECT_NET</pre>, <pre>MKM_LOW</pre>, <pre>MKM_TREND</pre>, <pre>CT</pre> and so on.</li>
                                <li>You can filter results to include only retail or buylist prices with <pre>skip:retail</pre> and <pre>skip:buylist</pre>. You can also skip results that do not have retail or buylist prices, with <pre>skip:nosales</pre> and <pre>skip:nobuys</pre>, or results that do not have results at all, with <pre>skip:empty</pre>.</li>
                                <li>You may filter by the store <b>region</b> with <pre>region:VALUE</pre> using <pre>us</pre>, <pre>eu</pre>, or <pre>jp</pre> options.</li>
                                <li>Note that <pre>seller</pre> leave index results availabe - if you only want to look at the selected scraper(s) use the <pre>aseller</pre> option.</li>
                            </ul>
                            <li>You can filter by <b>price</b> with <pre>price&gt;VALUE</pre>, or <pre>price&lt;VALUE</pre> to exclude results that are above or below your range.</li>
                            <li>You can check if a cards is on a particular list of card with <b>on</b> supporting <pre>mtgstocks</pre> and <pre>tcgsyp</pre>.</li>
                        </ul>
                    </li>
                    <br>

                    <li>You can access <b>historical data</b> from a few major vendors by clicking on 📊 for each card.</li>
                    <li>Data is refreshed periodically over the day.</li>
                    <li>Entries are formatted as <i>card name (finish) - edition (collector #)</i>.</li>
                    <li>The percentage found in buylist offers is the <b>price ratio</b>, the higher it is, the more a vendor is looking to purchase that card.</li>
                    <li>This percentage is available only if the seller is selling copies of the same card at the same conditions.</li>
                    <li>Inventory prices refer to the stated conditions (and their accuracy depends on the data provider).</li>
                    <li>Buylist prices are always referring to NM conditions.</li>
                    <li>TCG Low is a special value referring to TCG algorithms that may differ from quantity and quality of listings.</li>
                    <li>If you hover on a buylist price, a small tooltip will appear displaying the corresponding trade-in price, if available.</li>
                    <li>In case of mistakes or incongruities, please notify the devs in the BAN Discord.</li>
                    <li>Should you find this content useful, consider clicking on one of the provided links to make a purchase on the website, and directly support BAN.</li>
                </ul>
             </div>
        {{else}}
            <script type="text/javascript" src="../js/copy2clip.js"></script>

            <script type="text/javascript">
                function updateSidebar(src, printings) {
                    {{if not .IsSealed}}
                        document.getElementById('cardImage').src=src;
                    {{else}}
                        document.getElementById('hoverImage').src=src;
                    {{end}}
                    document.getElementById('printings').innerHTML = printings;
                }

                function getLastSold(uuid) {
                    fetch('/api/tcgplayer/lastsold/' + uuid)
                    .then((response) => response.json())
                    .then((data) => {
                        document.getElementById('lastsolda' + uuid).setAttribute("href", "javascript:void(0)");
                        let table = document.getElementById(uuid);
                        table.style.display = "";
                        document.getElementById('lastsalesth').style.display = "";

                        if (data.length == 0) {
                            table.innerHTML = ' \
                                <tr style="background-color:rgba(0, 0, 0, 0);"> \
                                    <td colspan="4"> <center> N/A </center> </td> \
                                </tr>';
                        }
                        data.forEach(element => {
                            let newRow = table.insertRow()

                            let orderCell = newRow.insertCell();
                            let formatDate = new Date(element.orderDate);
                            let timestamp = formatDate.toISOString().slice(0, 10) + " " + formatDate.toLocaleTimeString();
                            let anchor = document.createElement("a")
                            anchor.classList.add("btn", "default");
                            anchor.innerText = timestamp;
                            orderCell.appendChild(anchor);

                            let condCell = newRow.insertCell();
                            condCell.style.textAlign = "center";
                            let condText = document.createTextNode(element.condition.replace(/[^A-Z]/g, '').replace('LP', 'SP'));
                            condCell.appendChild(condText);

                            let priceCell = newRow.insertCell();
                            priceCell.style.textAlign = "center";
                            let priceText = document.createTextNode("$ " + (element.purchasePrice + element.shippingPrice).toFixed(2));
                            priceCell.appendChild(priceText);

                            let qtyCell = newRow.insertCell();
                            qtyCell.style.textAlign = "center";
                            let qtyText = document.createTextNode(element.quantity + "x");
                            qtyCell.appendChild(qtyText);
                        });
                    });
                }
            </script>

            {{$emptyImg := "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}}
            <div>
                <table style="float: left; background-color: var(--background)">
                    {{if .IsSealed}}
                        <br><br>
                        <tr class="no-hover" style="background-color: var(--background)">
                            <td>
                                <div id="printings" style="max-width:354px; display: block;"></div>
                            </td>
                        </tr>
                    {{else}}
                        <tr class="no-hover" style="background-color: var(--background)">
                            <td>
                                <img id="cardImage" src="" width="354" height="493"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div id="printings" style="text-align: center; max-width:354px; display: block;"></div>
                                {{if .CanShowAll}}
                                    <center>
                                        <a class="btn info" href="search?q={{.CleanSearchQuery}}">Show all versions</a>
                                    </center>
                                {{end}}
                            </td>
                        </tr>
                        {{if not (eq .Alternative "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn warning" href="/search?chart={{.Alternative}}">Switch Foil/Non-Foil</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                        {{if not (eq .AltEtchedId "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn warning" href="/search?chart={{.AltEtchedId}}">Switch Etched/Non-Etched</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                        {{if not (eq .StocksURL "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn success" href="{{.StocksURL}}" target="_blank">Check MTGStocks charts</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                        {{if .CanDownloadCSV}}
                            <tr>
                                <td>
                                    <center>
                                        Download prices as CSV<br>
                                        <a class="btn success" href="search?q={{.SearchQuery}}&downloadCSV=retail" target="_blank">Retail</a>
                                        <a class="btn warning" href="search?q={{.SearchQuery}}&downloadCSV=buylist" target="_blank">Buylist</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                    {{end}}
                    <tr>
                        <td style="background-color: var(--background);">
                            {{if .HasReserved}}
                                <h4>
                                    {{if not (eq .ChartID "")}}<center>{{else}}* ={{end}}
                                    Part of the <a href="https://mtg.gamepedia.com/Reserved_List">Reserved List</a>
                                    {{if not (eq .ChartID "")}}</center>{{end}}
                                </h4>
                            {{end}}
                            {{if .HasStocks}}
                                <h4>
                                    {{if not (eq .ChartID "")}}<center>{{else}}• ={{end}}
                                    On <a href="https://mtgstocks.com/interests">MTGStocks Interests</a> page
                                    {{if not (eq .ChartID "")}}</center>{{end}}
                                </h4>
                            {{end}}
                            {{if .HasSypList}}
                                <h4>
                                    {{if not (eq .ChartID "")}}<center>{{else}}† ={{end}}
                                    Found in the <a href="https://help.tcgplayer.com/hc/en-us/articles/360054178934-Store-Your-Products-SYP-Pull-Sheet">SYP Pull Sheet</a>
                                    {{if not (eq .ChartID "")}}</center>{{end}}
                                </h4>
                            {{end}}
                        </td>
                    </tr>
                </table>
            </div>
        </div>

            <div class="indent sticky">
                {{$firstImg := ""}}
                {{$firstPrint := ""}}

                {{if not (eq .ChartID "")}}
                    <div style="margin-left: 10px; float: left;">
                        <canvas id="cardChart" width="740" height="420"></canvas>
                        <br>
                        <hr>
                        <br>
                    </div>
                    <script>
                        var ctx = document.getElementById('cardChart').getContext('2d');
                        var cardChart = new Chart(ctx, {
                            type: 'banWithLine',
                            data: {
                                labels: {{.AxisLabels}},
                                datasets: [
                                    {{range .Datasets}}
                                        {
                                            label: {{.Name}},
                                            data: {{.Data}},
                                            hidden: {{.Hidden}},
                                            backgroundColor: {{.Color}},
                                            borderColor: {{.Color}},
                                            fill: false,
                                            pointRadius: 0,
                                        },
                                    {{end}}
                                ]
                            },
                            options: getChartOpts(),
                        });
                    </script>
                {{end}}

                <table style="background-color: var(--background); float:left;" {{if .IsSealed}}onmouseout="document.getElementById('hoverImage').src='{{$emptyImg}}';"{{end}}>
                    {{if .AllKeys}}
                        <tr>
                            <th class="stickyCategory"><h2 align=center>Sellers</h2></th>
                            <th class="stickyCategory"><h2 align=center>Buyers</h2></th>
                            <th class="stickyCategory"><h2 align=center style="display:none" id="lastsalesth">Last Sales</h2></th>
                        </tr>
                    {{end}}

                    {{range $cardId := .AllKeys}}
                        {{$card := (index $.Metadata $cardId)}}
                        {{if eq $firstImg ""}}
                            {{$firstImg = $card.ImageURL}}
                            {{$firstPrint = $card.Printings}}
                        {{end}}

                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});" title="{{$card.Title}}">
                            <th colspan="3" class="wrap stickyHeader" style="text-align: left; vertical-align: middle;">
                                <table style="margin:0 0 0 18">
                                    <tr style="background-color:rgba(0, 0, 0, 0);">
                                        <td rowspan=2>
                                            <a href="search?q=s:{{$card.SetCode}}">
                                                <i class="ss {{$card.Keyrune}} ss-2x ss-fw"></i>
                                            </a>
                                        </td>
                                        <td width=100%>
                                            <a href="{{$card.SearchURL}}">
                                                {{$card.Name}}
                                            </a>
                                            {{if ne $card.Variant ""}}
                                                <i>({{$card.Variant}})</i>
                                            {{end}}
                                            {{if $card.Reserved}}
                                                *
                                            {{end}}
                                            {{if $card.Stocks}}
                                                •
                                            {{end}}
                                            {{if $card.SypList}}
                                                †
                                            {{end}}
                                        </td>
                                        <td rowspan=2>
                                            <span class="emoji" style="cursor: pointer;" onclick="navigator.clipboard.writeText('{{$card.Name}}'); waithide(this)" title="Copy to clipboard">📝</span>
                                        </td>
                                        <td rowspan=2>
                                            <a href="https://scryfall.com/card/{{tolower $card.SetCode}}/{{$card.Number}}" title="Check this card on Scryfall.com" target=_blank><img width=28 src="img/logo/scryfall.svg"></a>
                                        </td>
                                        {{if $card.TCGId}}
                                            <td rowspan=2>
                                                    <a href="https://store.tcgplayer.com/admin/product/manage/{{$card.TCGId}}" title="Manage your TCGplayer inventory" target=_blank><img width=22 src="img/logo/tcgapp.png"></a>
                                            </td>
                                            <td rowspan=2>
                                                <a href="javascript:getLastSold('{{$cardId}}')" title="Retrieve last sales on TCG" id="lastsolda{{$cardId}}"><span class="emoji">💸</span></a>
                                            </td>
                                        {{end}}
                                        {{if eq $.ChartID ""}}
                                            <td rowspan=2>
                                                <span class="emoji">
                                                    <a href="?chart={{$cardId}}" title="See historical data">📊</a>
                                                </span>
                                            </td>
                                        {{end}}
                                    </tr>
                                    <tr style="background-color:rgba(0, 0, 0, 0); margin-bottom: 0px;">
                                        <td>
                                            <h6>
                                                <a href="?q=s:{{$card.SetCode}}{{if $card.Date}} date:{{$card.Date}}{{end}}">{{$card.Title}}</a>
                                            </h6>
                                        </td>

                                    </tr>
                                </table>
                            </th>
                        </tr>

                        <tr class="no-hover" style="background-color:rgba(0,0,0,0);" onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});" style="background-color:rgba(0, 0, 0, 0);">
                            {{$condsEntry := (index $.FoundSellers $cardId)}}
                            <td style="vertical-align: {{if not $condsEntry}}middle{{else}}top{{end}}; padding: 0; margin: 0;">
                                <table class="searchResults" style="margin: 0 6px 0 12px;">
                                    {{if not $condsEntry}}
                                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});" style="background-color:rgba(0, 0, 0, 0);">
                                            <td colspan="4">
                                                <center>
                                                    <i>No offers</i>
                                                </center>
                                            </td>
                                        </tr>
                                    {{end}}
                                    {{range $conditions := $.CondKeys}}
                                        {{$entries := (index $condsEntry $conditions)}}
                                        {{if ne $conditions "INDEX"}}
                                            {{if $entries}}
                                                <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                    <td colspan="4" style="padding-top: 8px; padding-bottom: 8px"><i>{{if $.IsSealed}}Available offers{{else}}Conditions: {{$conditions}}{{end}}</i></td>
                                                </tr>
                                            {{end}}
                                        {{end}}
                                        {{range $entries}}
                                            <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                <td>
                                                    <a class="btn normal" href="{{.URL}}" target="_blank" rel="nofollow">
                                                        {{.ScraperName}}
                                                        {{if ne $conditions "INDEX"}}
                                                            {{.Country}}
                                                        {{end}}
                                                    </a>
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;">
                                                    $ {{printf "%.2f" .Price}}
                                                </td>
                                                {{if .IndexCombined}}
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        /
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        $ {{printf "%.2f" .Secondary}}
                                                    </td>
                                                {{else}}
                                                    <td>
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        {{if .BundleIcon}}
                                                            <img style="padding-top:4px;" src="{{.BundleIcon}}">
                                                        {{else if not .NoQuantity}}
                                                            {{.Quantity}}
                                                        {{end}}
                                                    </td>
                                                {{end}}
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            </td>

                            {{$condsEntry := (index $.FoundVendors $cardId)}}
                            <td style="vertical-align: {{if not $condsEntry}}middle{{else}}top{{end}}; padding: 0; margin: 0;">
                                <table class="searchResults" style="margin: 0 6px 0 12px;">
                                    {{if not $condsEntry}}
                                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});" style="background-color:rgba(0, 0, 0, 0);">
                                            <td colspan="4">
                                                <center>
                                                    <i>No offers</i>
                                                </center>
                                            </td>
                                        </tr>
                                    {{end}}
                                    {{range $conditions := $.CondKeys}}
                                        {{$entries := (index $condsEntry $conditions)}}
                                        {{if ne $conditions "INDEX"}}
                                            {{if $entries }}
                                                <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                    <td colspan="4" style="padding-top: 8px; padding-bottom: 8px"><i>{{if $.IsSealed}}Available offers{{else}}Conditions: {{$conditions}}{{end}}</i></td>
                                                </tr>
                                            {{end}}
                                        {{end}}
                                        {{range $entries}}
                                            <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                <td>
                                                    <a class="btn normal" href="{{.URL}}" target="_blank" rel="nofollow">
                                                        {{.ScraperName}} {{.Country}}
                                                    </a>
                                                </td>
                                                <td {{if .Credit}}title="Credit: $ {{printf "%.2f" .Credit}}"{{end}}>
                                                    $ {{printf "%.2f" .Price}}
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;">
                                                    {{if eq $conditions "NM"}}
                                                        {{if ne .Ratio 0.0}}{{printf "%.2f" .Ratio}} %{{end}}
                                                    {{end}}
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;">
                                                    {{if and .Quantity (eq $conditions "NM")}}
                                                        {{.Quantity}}
                                                    {{end}}
                                                </td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            </td>

                            <td style="vertical-align: top; padding: 0; margin: 0;">
                                <table class="searchResults" style="margin: 0 12px 0 6px; display:none" id="{{$cardId}}">
                                </table>
                            </td>
                        </tr>
                    {{end}}
                    {{if .CurrentIndex}}
                        <tr style="background-color: var(--headerbackground);">
                            <td colspan="2" style="text-align: center; vertical-align: middle;">
                                <p style="display: inline;">
                                    {{if ne .CurrentIndex 1}}
                                        <a class="pagination" href="?q={{.SearchQuery}}&p=1&sort={{.SearchSort}}&reverse={{.ReverseMode}}">&lt;</a>
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.PrevIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}"><i class="arrow left"></i></a>
                                    {{end}}
                                    {{.CurrentIndex}} / {{.TotalIndex}}
                                    {{if ne .CurrentIndex .TotalIndex}}
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.NextIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}"><i class="arrow right"></i></a>
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.TotalIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}">&gt;</a>
                                    {{end}}
                                </p>
                            </td>
                        </tr>
                    {{end}}
                    {{if ne .InfoMessage ""}}
                        <tr>
                            <td colspan="2" style="text-align: center; vertical-align: middle;">
                                <h4 class="indent"><i>{{.InfoMessage}}</i></h4>
                            </td>
                        </tr>
                    {{end}}
                </table>
                {{if eq $firstImg ""}}
                    {{$firstImg = "https://cards.scryfall.io/back.png"}}
                {{end}}
                {{if .IsSealed}}
                    {{$firstImg = $emptyImg}}
                {{end}}
                <script type="text/javascript">
                    updateSidebar({{$firstImg}}, {{$firstPrint}});
                </script>
            </div>
        {{end}}
        <div style="clear:both;"></div>
    {{end}}
    <br>
</div>
</body>
</html>
