<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Rosario:400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="../css/main.css">
    <title>BAN Admin - {{.Title}}</title>
</head>

<body class="light-theme">
<script type="text/javascript" src="../js/themechecker.js"></script>
<nav>
    <ul>
        <li><a href="https://www.patreon.com/ban_community"><img src="img/misc/patreon.png" width=48></a></li>
        <li><a href="/discord"><img src="img/misc/discord.png" width=48></a></li>
        {{range .Nav}}
            <li>
                <a {{if .Active}}class="{{.Class}}"{{end}} href="{{.Link}}">
                    <span>{{.Short}} {{.Name}}</span>
                </a>
            </li>
        {{end}}
        <li>
            <label class="switch">
                <div>
                    <input type="checkbox"/>
                    <span class="slider"></span>
                </div>
                <script type="text/javascript" src="../js/nightmode.js"></script>
            </label>
        </li>
    </ul>
</nav>

<div class="mainbody">
    {{if ne .ErrorMessage ""}}
        <h1>{{.ErrorMessage}}</h1>
    {{else}}
        <h1>Welcome to BAN Admin</h1>

        <div class="indent">
            <h2>{{.InfoMessage}}</h2>
        </div>
        <br>
        {{range $e, $key := $.AllKeys}}
            <div class="indent">
                <table style="float: left;">
                    <tr>
                        {{range $.Headers}}
                            <th class="wrap stickyHeader" style="top:48px">
                                {{.}}
                            </th>
                        {{end}}
                    </tr>
                    {{$table := index $.Tables $e}}
                    {{range $i, $row := $table}}
                        <tr>
                            <td>
                                <span class="emoji">‚òÅÔ∏è</span>
                            </td>
                            {{range $j, $cell := $row}}
                                <td>
                                    {{if eq $j 0}}
                                        <a href="#" onclick="if (confirm('Are you sure you want to refresh {{$cell}}?')) { location.replace('/api/bq/refresh/{{index $row 2}}?redir=true&sig={{$.DemoKey}}'); return true; } else { return false; } ">{{$cell}}</a>
                                    {{else if eq $j 1}}
                                        {{$cell}}
                                    {{else}}
                                        {{if eq $j 4}}
                                            <center>
                                        {{end}}
                                        {{$cell}}
                                        {{if eq $j 4}}
                                            </center>
                                        {{end}}
                                    {{end}}
                                </td>
                            {{end}}
                        </tr>
                    {{end}}
                </table>
            </div>
        {{end}}
        <br>
        <div style="clear:both;"></div>
        <br>
        <div class="indent" style="float: left;">
            <ul class="indent">
                <li><a href="?reboot=infos" onclick="return confirm('Are you sure you want to refresh mtgstocks?')">üìâ Reload Infos (MTGStock, SYP, etc)</a></li>
                <li><a href="?reboot=mtgjson" onclick="return confirm('Are you sure you want to reload mtgjson?')">üîÑ Reload MTGJSON</a></li>
                <li>üèóÔ∏è <a href="?reboot=update" onclick="return confirm('Are you sure you want to do a deploy?')">Deploy</a>
                   (<a href="?reboot=build" onclick="return confirm('Are you sure you want to build the code?')">Build</a> +
                    <a href="?reboot=code" onclick="return confirm('Are you sure you want to pull new code?')">Pull</a> +
                    <a href="?reboot=server" onclick="return confirm('Are you sure you want to restart the server?')">Restart</a>)
                <li><a href="?reboot=config" onclick="return confirm('Are you sure you want to reload config?')">‚öôÔ∏è Reload config</a></li>
                <li><a href="?reboot=scrapers" onclick="return confirm('Are you sure you want to reload scrapers from BQ?')">üîÉ Reload everything from BQ</a></li>
                <li><a href="?reboot=server" onclick="return confirm('Are you sure you want to restart the server?')">‚ö†Ô∏è Restart the server</a></li>
            </ul>
        </div>

        <div class="indent" style="float: left;">
            <ul class="indent">
                <li>Server uptime: {{.Uptime}}</li>
                <li>Disk status: {{.DiskStatus}}</li>
                <li>Memory status: {{.MemoryStatus}}</li>
                <li>Last Refresh: {{.LastUpdate}}</li>
                <li>Current time: {{.CurrentTime}}</li>
                <li>Latest Hash: <a target="_blank" href="https://github.com/kodabb/mtgban-website/commit/{{.LatestHash}}">{{.LatestHash}}</a></li>
            </ul>
        </div>

        <div class="indent" style="float: left;">
            <ul class="indent">
                <li>
                    Spoof User Tier
                    <form action="admin" method="GET">
                        <select name="spoof" onchange="this.form.submit()" class="select-css">
                            <option disabled selected value="">~ choose tier ~</option>
                            {{range .Tiers}}
                                <option value="{{.}}">{{.}}</option>
                            {{end}}
                        </select>
                    </form>
                </li>
                <li>
                    API Demo Key
                    <form>
                        <input value="{{.DemoKey}}" onClick="this.setSelectionRange(0, this.value.length)" class="input-css">
                    </form>
                </li>
                <li>
                    Generate New Key
                    <form>
                        <input type="hidden" name="reboot" value="newKey"/>
                        <input name="user" id="user" placeholder="User email" class="input-css">
                        <select name="duration" class="select-css" style="width: 30px; line-height: inherit;" onchange="if (document.getElementById('user').value !== '') { this.form.submit() }">
                            <option selected value=""></option>
                                <option value="0">No expiration</option>
                                <option value="15">Two weeks</option>
                                <option value="31">One month</option>
                                <option value="183">Half year</option>
                                <option value="365">One year</option>
                        </select>
                    </form>
                </li>
            </ul>
        </div>

        <div style="clear:both;"></div>
        <br>
        <br>
    {{end}}
</div>
</body>
</html>
